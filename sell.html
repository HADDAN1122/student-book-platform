<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="responsive.css">
    <title>Sell & Buy Books | Student Book Platform</title>
    <style>
        /* Fallback styles if CSS doesn't load */
        .sell-buy-tabs { display: flex; gap: 10px; margin-bottom: 20px; }
        .sell-buy-tab { padding: 10px 20px; border: none; background: #f0f0f0; cursor: pointer; border-radius: 5px; }
        .sell-buy-tab.active { background: #007bff; color: white; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .error-message { color: #dc3545; margin-top: 10px; padding: 10px; background: #f8d7da; border-radius: 4px; display: none; }
    </style>
</head>
<body>
    <header>
        <h1>Student Book Platform</h1>
        <nav>
            
            <a href="exchange.html">Exchange Book</a>
            <a href="admin.html">Upload</a>
            <a href="search.html">Search</a>
            <a href="login.html" class="login-circle">Login</a>
        </nav>
        <hr>
    </header>

    <main>
        <!-- Hero Section for Sell Page -->
        <section class="page-hero">
            <h1>Sell or Buy Textbooks</h1>
            <p>Connect with fellow students to trade textbooks at affordable prices</p>
        </section>

        <!-- Main Sell Form Container -->
        <div class="sell-form-container">
            <!-- Tabs for Sell/Buy -->
            <div class="sell-buy-tabs">
                <button class="sell-buy-tab active" id="sellTab" data-tab="sell">
                    üì§ Sell Book
                </button>
                <button class="sell-buy-tab" id="buyTab" data-tab="buy">
                    üõí Buy Book
                </button>
            </div>

            <h2 class="form-title" id="formTitle">Post Your Book for Sale</h2>
            <p class="form-subtitle" id="formSubtitle">Fill in the details below to list your book</p>
            
            <!-- SELL FORM -->
            <form id="sellForm" class="tab-content active" data-tab="sell">
                <!-- Book Details Section -->
                <div class="form-section">
                    <h3 class="section-title">Book Information</h3>
                    
                    <div class="form-group">
                        <label for="bookName">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/>
                                <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/>
                            </svg>
                            Book Name *
                        </label>
                        <input type="text" id="bookName" placeholder="Enter book title (e.g., Mathematics 9th Class)" required>
                        <div class="input-hint">Enter the exact title as on cover</div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="bookClass">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M12 19l7-7 3 3-7 7-3-3z"/>
                                    <path d="M18 13l-1.5-7.5L2 2l3.5 14.5L13 18l5-5z"/>
                                    <path d="M2 2l7.586 7.586"/>
                                    <circle cx="11" cy="11" r="2"/>
                                </svg>
                                Class/Grade *
                            </label>
                            <input type="text" id="bookClass" placeholder="e.g., 9th, 10th, BSc" required>
                        </div>

                        <div class="form-group">
                            <label for="subject">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <circle cx="12" cy="12" r="10"/>
                                    <line x1="2" y1="12" x2="22" y2="12"/>
                                    <path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/>
                                </svg>
                                Subject *
                            </label>
                            <input type="text" id="subject" placeholder="e.g., Mathematics, Physics" required>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="board">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="2" y="2" width="20" height="20" rx="2.18" ry="2.18"/>
                                <line x1="7" y1="2" x2="7" y2="22"/>
                                <line x1="17" y1="2" x2="17" y2="22"/>
                                <line x1="2" y1="12" x2="22" y2="12"/>
                                <line x1="2" y1="7" x2="7" y2="7"/>
                                <line x1="2" y1="17" x2="7" y2="17"/>
                                <line x1="17" y1="17" x2="22" y2="17"/>
                                <line x1="17" y1="7" x2="22" y2="7"/>
                            </svg>
                            Education Board *
                        </label>
                        <select id="board" required>
                            <option value="">Select Board</option>
                            <option>Punjab Board</option>
                            <option>FBISE (Federal Board)</option>
                            <option>Cambridge</option>
                            <option>Aga Khan Board</option>
                            <option>Other Board</option>
                        </select>
                    </div>
                </div>

                <!-- Pricing Section -->
                <div class="form-section">
                    <h3 class="section-title">Pricing & Condition</h3>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="price">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <line x1="12" y1="1" x2="12" y2="23"/>
                                    <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/>
                                </svg>
                                Price (PKR) *
                            </label>
                            <div class="price-input-wrapper">
                                <span class="currency">‚Ç®</span>
                                <input type="number" id="price" placeholder="0" min="50" max="5000" required>
                            </div>
                            <div class="price-slider">
                                <input type="range" id="priceRange" min="50" max="5000" value="500" step="50">
                                <div class="slider-labels">
                                    <span>‚Ç®50</span>
                                    <span>‚Ç®2,500</span>
                                    <span>‚Ç®5,000</span>
                                </div>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="condition">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polyline points="20 6 9 17 4 12"/>
                                </svg>
                                Book Condition *
                            </label>
                            <select id="condition" required>
                                <option value="">Select Condition</option>
                                <option>New (Never Used)</option>
                                <option>Like New (Minimal Use)</option>
                                <option>Good (Minor Wear)</option>
                                <option>Fair (Visible Wear)</option>
                                <option>Poor (Heavy Wear)</option>
                            </select>
                            <div class="condition-hint" id="conditionHint">Select to see description</div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="description">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                                <polyline points="14 2 14 8 20 8"/>
                                <line x1="16" y1="13" x2="8" y2="13"/>
                                <line x1="16" y1="17" x2="8" y2="17"/>
                                <polyline points="10 9 9 9 8 9"/>
                            </svg>
                            Additional Description
                        </label>
                        <textarea id="description" placeholder="Describe any marks, highlights, missing pages, or other details..." rows="4" maxlength="500"></textarea>
                        <div class="char-counter"><span id="charCount">0</span>/500 characters</div>
                    </div>
                </div>
          
                <!-- Submit Section -->
                <div class="form-submit-section">
                    <div class="form-agreement">
                        <input type="checkbox" id="agreeTerms" required>
                        <label for="agreeTerms">
                            I agree to the <a href="#">Terms of Service</a> and confirm that my book details are accurate
                        </label>
                    </div>

                    <div class="submit-buttons">
                        <button type="button" class="preview-btn" id="previewBtn">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
                                <circle cx="12" cy="12" r="3"/>
                            </svg>
                            Preview Listing
                        </button>
                        <button type="submit" class="submit-btn">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
                                <polyline points="22 4 12 14.01 9 11.01"/>
                            </svg>
                            Post Book for Sale
                        </button>
                    </div>

                    <div id="sellError" class="error-message"></div>
                </div>
            </form>

            <!-- BUY FORM -->
            <form id="buyForm" class="tab-content" data-tab="buy">
                <!-- Search Section -->
                <div class="form-section">
                    <h3 class="section-title">What Book Are You Looking For?</h3>
                    
                    <div class="form-group">
                        <label for="buyBookName">
                            üîç Book Name *
                        </label>
                        <input type="text" id="buyBookName" placeholder="Enter book title you want to buy" required>
                        <div class="input-hint">Be specific for better matches</div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="buyClass">üìö Class/Grade *</label>
                            <input type="text" id="buyClass" placeholder="e.g., 9th, 10th, BSc" required>
                        </div>

                        <div class="form-group">
                            <label for="buySubject">üìñ Subject *</label>
                            <input type="text" id="buySubject" placeholder="e.g., Mathematics, Physics" required>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="buyBoard">üè´ Education Board *</label>
                        <select id="buyBoard" required>
                            <option value="">Select Board</option>
                            <option>Punjab Board</option>
                            <option>FBISE (Federal Board)</option>
                            <option>Cambridge</option>
                            <option>Aga Khan Board</option>
                            <option>Other Board</option>
                        </select>
                    </div>
                </div>

                <!-- Budget Section -->
                <div class="form-section">
                    <h3 class="section-title">Your Budget & Requirements</h3>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="buyMaxPrice">üí∞ Maximum Price (PKR) *</label>
                            <div class="price-input-wrapper">
                                <span class="currency">‚Ç®</span>
                                <input type="number" id="buyMaxPrice" placeholder="0" min="50" max="5000" required>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="buyCondition">‚úÖ Acceptable Condition *</label>
                            <select id="buyCondition" required>
                                <option value="">Select Condition</option>
                                <option>Any Condition</option>
                                <option>New or Like New</option>
                                <option>Good or Better</option>
                                <option>Fair or Better</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="buyNotes">üìù Additional Requirements (Optional)</label>
                        <textarea id="buyNotes" placeholder="Any specific edition, author, or other requirements..." rows="3"></textarea>
                    </div>
                </div>

                
                <!-- Submit Section -->
                <div class="form-submit-section">
                    <div class="form-agreement">
                        <input type="checkbox" id="buyAgreeTerms" required>
                        <label for="buyAgreeTerms">
                            I agree to the <a href="#">Terms of Service</a> and will respond to seller offers promptly
                        </label>
                    </div>

                    <div class="submit-buttons">
                        <button type="button" class="preview-btn" id="buyPreviewBtn">
                            üëÅÔ∏è Preview Request
                        </button>
                        <button type="submit" class="submit-btn">
                            ‚úÖ Post Buy Request
                        </button>
                    </div>

                    <div id="buyError" class="error-message"></div>
                </div>
            </form>
        </div>

        <!-- Tips Section -->
        <section class="sell-tips">
            <h2>Selling Tips</h2>
            <div class="tips-grid">
                <div class="tip-card">
                    <div class="tip-icon">üì∑</div>
                    <h3>Clear Photos</h3>
                    <p>Take well-lit photos showing cover, contents, and any damage</p>
                </div>
                <div class="tip-card">
                    <div class="tip-icon">üí∞</div>
                    <h3>Fair Pricing</h3>
                    <p>Check similar listings to price competitively</p>
                </div>
                <div class="tip-card">
                    <div class="tip-icon">üìù</div>
                    <h3>Honest Description</h3>
                    <p>Mention all defects to avoid disputes</p>
                </div>
                <div class="tip-card">
                    <div class="tip-icon">‚ö°</div>
                    <h3>Quick Response</h3>
                    <p>Respond to buyer inquiries within hours</p>
                </div>
            </div>
        </section>
    </main>

    <!-- FIREBASE SDKs -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-storage.js"></script>

    <!-- FIREBASE CONFIG -->
    <script src="firebase.js"></script>

    <!-- AUTH FUNCTIONS -->
    <script src="auth.js"></script>

    <!-- PAGE-SPECIFIC JAVASCRIPT -->
    <script>
        // Tab switching functionality
        document.addEventListener('DOMContentLoaded', function() {
            // Tab elements
            const sellTab = document.getElementById('sellTab');
            const buyTab = document.getElementById('buyTab');
            const sellForm = document.getElementById('sellForm');
            const buyForm = document.getElementById('buyForm');
            const formTitle = document.getElementById('formTitle');
            const formSubtitle = document.getElementById('formSubtitle');
            
            // Tab switching
            sellTab.addEventListener('click', () => switchTab('sell'));
            buyTab.addEventListener('click', () => switchTab('buy'));
            
            function switchTab(tab) {
                // Update active tab
                sellTab.classList.toggle('active', tab === 'sell');
                buyTab.classList.toggle('active', tab === 'buy');
                
                // Show/hide forms
                sellForm.classList.toggle('active', tab === 'sell');
                buyForm.classList.toggle('active', tab === 'buy');
                
                // Update title and subtitle
                if (tab === 'sell') {
                    formTitle.textContent = 'Post Your Book for Sale';
                    formSubtitle.textContent = 'Fill in the details below to list your book';
                } else {
                    formTitle.textContent = 'Find a Book to Buy';
                    formSubtitle.textContent = 'Tell us what book you\'re looking for';
                }
            }
            
            // Character counter for description
            const description = document.getElementById('description');
            const charCount = document.getElementById('charCount');
            
            if (description && charCount) {
                description.addEventListener('input', function() {
                    charCount.textContent = this.value.length;
                });
            }
            
            // Price slider synchronization
            const priceInput = document.getElementById('price');
            const priceRange = document.getElementById('priceRange');
            
            if (priceInput && priceRange) {
                priceRange.addEventListener('input', function() {
                    priceInput.value = this.value;
                });
                
                priceInput.addEventListener('input', function() {
                    priceRange.value = this.value;
                });
            }
            
            // Form submissions
            sellForm.addEventListener('submit', handleSellSubmit);
            buyForm.addEventListener('submit', handleBuySubmit);
            
            // Preview buttons
            document.getElementById('previewBtn').addEventListener('click', previewSellListing);
            document.getElementById('buyPreviewBtn').addEventListener('click', previewBuyRequest);
        });
        
        function handleSellSubmit(e) {
            e.preventDefault();
            
            // Validate user is logged in
            if (!firebase.auth().currentUser) {
                showError('sellError', 'Please login to post a book for sale');
                return;
            }
            
            // Collect form data
            const bookData = {
                bookName: document.getElementById('bookName').value,
                bookClass: document.getElementById('bookClass').value,
                subject: document.getElementById('subject').value,
                board: document.getElementById('board').value,
                price: document.getElementById('price').value,
                condition: document.getElementById('condition').value,
                description: document.getElementById('description').value,
                postedBy: firebase.auth().currentUser.uid,
                postedAt: firebase.firestore.FieldValue.serverTimestamp(),
                status: 'available',
                type: 'sell'
            };
            
            // Save to Firestore
            firebase.firestore().collection('books').add(bookData)
                .then((docRef) => {
                    console.log('Book listed with ID:', docRef.id);
                    showSuccess('sellError', 'Book listed successfully!', true);
                    sellForm.reset();
                    // Redirect after 2 seconds
                    setTimeout(() => {
                        window.location.href = 'index.html';
                    }, 2000);
                })
                .catch((error) => {
                    console.error('Error adding book:', error);
                    showError('sellError', 'Error listing book: ' + error.message);
                });
        }
        
        function handleBuySubmit(e) {
            e.preventDefault();
            
            // Validate user is logged in
            if (!firebase.auth().currentUser) {
                showError('buyError', 'Please login to post a buy request');
                return;
            }
            
            // Collect form data
            const buyRequest = {
                bookName: document.getElementById('buyBookName').value,
                bookClass: document.getElementById('buyClass').value,
                subject: document.getElementById('buySubject').value,
                board: document.getElementById('buyBoard').value,
                maxPrice: document.getElementById('buyMaxPrice').value,
                condition: document.getElementById('buyCondition').value,
                notes: document.getElementById('buyNotes').value,
                
                requestedBy: firebase.auth().currentUser.uid,
                requestedAt: firebase.firestore.FieldValue.serverTimestamp(),
                status: 'active',
                type: 'buy'
            };
            
            // Save to Firestore
            firebase.firestore().collection('buyRequests').add(buyRequest)
                .then((docRef) => {
                    console.log('Buy request posted with ID:', docRef.id);
                    showSuccess('buyError', 'Buy request posted successfully!', true);
                    buyForm.reset();
                })
                .catch((error) => {
                    console.error('Error posting buy request:', error);
                    showError('buyError', 'Error posting request: ' + error.message);
                });
        }
        
        function previewSellListing() {
            const bookName = document.getElementById('bookName').value;
            if (!bookName) {
                alert('Please enter a book name first');
                return;
            }
            
            // Collect all form data
            const formData = {
                bookName: document.getElementById('bookName').value,
                bookClass: document.getElementById('bookClass').value,
                subject: document.getElementById('subject').value,
                board: document.getElementById('board').value,
                price: document.getElementById('price').value,
                condition: document.getElementById('condition').value,
                description: document.getElementById('description').value
            };
            
            // Store in sessionStorage and open preview
            sessionStorage.setItem('previewData', JSON.stringify(formData));
            window.open('preview.html?type=sell', '_blank');
        }
        
        function previewBuyRequest() {
            const bookName = document.getElementById('buyBookName').value;
            if (!bookName) {
                alert('Please enter a book name first');
                return;
            }
            
            // Collect all form data
            const formData = {
                bookName: document.getElementById('buyBookName').value,
                bookClass: document.getElementById('buyClass').value,
                subject: document.getElementById('buySubject').value,
                board: document.getElementById('buyBoard').value,
                maxPrice: document.getElementById('buyMaxPrice').value,
                condition: document.getElementById('buyCondition').value,
                notes: document.getElementById('buyNotes').value,
                contact: document.getElementById('buyContact').value
            };
            
            // Store in sessionStorage and open preview
            sessionStorage.setItem('previewData', JSON.stringify(formData));
            window.open('preview.html?type=buy', '_blank');
        }
        
        function showError(elementId, message) {
            const errorElement = document.getElementById(elementId);
            errorElement.textContent = message;
            errorElement.style.display = 'block';
            errorElement.style.backgroundColor = '#f8d7da';
            errorElement.style.color = '#721c24';
        }
        
        function showSuccess(elementId, message, isSuccess = true) {
            const element = document.getElementById(elementId);
            element.textContent = message;
            element.style.display = 'block';
            element.style.backgroundColor = isSuccess ? '#d4edda' : '#f8d7da';
            element.style.color = isSuccess ? '#155724' : '#721c24';
        }
        
        // Shrink header on scroll
        window.addEventListener('scroll', function() {
            const header = document.querySelector('header');
            if (window.scrollY > 50) {
                header.classList.add('shrink');
            } else {
                header.classList.remove('shrink');
            }
        });
    </script>
</body>
</html>